---
// src/components/Header.astro
const base = import.meta.env.BASE_URL;

const pathname = Astro.url.pathname;
const isHome = pathname === base || pathname === `${base}/`;
---

{/* Fixed container for banner + header */}
<div id="header-wrapper" class="fixed top-0 left-0 right-0 z-50">


    <header
        id="main-header"
        class="w-full transition-all duration-300 bg-white/80 backdrop-blur-md border-b border-transparent"
    >
        <div
            class="mx-auto flex max-w-7xl items-center justify-between px-4 py-3 sm:px-6 lg:px-8"
        >
            {/* Logo */}
            <div class="flex-shrink-0 relative z-50">
                <a href={base} class="flex items-center gap-3 group">
                    <img
                        src={`${base}logo.png`}
                        alt="The Latina Sweat Project Logo"
                        class="h-8 w-8 md:h-10 md:w-10 transition-transform duration-300 group-hover:scale-110"
                    />
                    <span
                        class="text-lg md:text-xl font-bold text-off-black tracking-tight group-hover:text-vibrant-pink transition-colors duration-300"
                        >The Latina Sweat Project</span
                    >
                </a>
            </div>

            {/* Desktop Navigation */}
            <div class="hidden xl:flex items-center gap-8">
                <nav class="flex items-center gap-6">
                    <a
                        href={base}
                        class="link-underline relative z-10 py-2 text-base font-medium text-medium-gray"
                    >
                        Home
                    </a>
                    <a
                        href={`${base}about`}
                        class="link-underline relative z-10 py-2 text-base font-medium text-medium-gray"
                    >
                        About Us
                    </a>
                    <a
                        href={`${base}schedule`}
                        class="link-underline relative z-10 py-2 text-base font-medium text-medium-gray"
                    >
                        Classes
                    </a>
                    <a
                        href={`${base}events`}
                        class="link-underline relative z-10 py-2 text-base font-medium text-medium-gray"
                    >
                        Events
                    </a>
                    <a
                        href={`${base}impact`}
                        class="link-underline relative z-10 py-2 text-base font-medium text-medium-gray"
                    >
                        Impact
                    </a>
                    <a
                        href={`${base}gala`}
                        class="link-underline relative z-10 py-2 text-base font-medium text-medium-gray"
                    >
                        Gala
                    </a>

                    {/* More Dropdown */}
                    <div id="more-dropdown-container" class="relative group">
                        <button
                            id="more-dropdown-button"
                            class="link-underline flex items-center gap-1 py-2 text-base font-medium text-medium-gray focus:outline-none"
                            aria-expanded="false"
                        >
                            More
                            <svg
                                class="h-4 w-4 transition-transform duration-200 group-hover:rotate-180"
                                fill="none"
                                viewBox="0 0 24 24"
                                stroke="currentColor"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>

                        <div
                            id="more-dropdown-menu"
                            class="absolute right-0 top-full pt-4 w-56 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 transform origin-top-right z-50"
                        >
                            <div
                                class="bg-white rounded-xl shadow-xl ring-1 ring-black/5 overflow-hidden p-2"
                            >
                                <a
                                    href={`${base}shifts`}
                                    class="dropdown-link block px-4 py-2.5 text-sm text-medium-gray rounded-lg"
                                >
                                    <span class="dropdown-link-text">Volunteer</span>
                                </a>
                                <a
                                    href={`${base}pricing`}
                                    class="dropdown-link block px-4 py-2.5 text-sm text-medium-gray rounded-lg"
                                >
                                    <span class="dropdown-link-text">Pricing</span>
                                </a>
                                <a
                                    href={`${base}gallery`}
                                    class="dropdown-link block px-4 py-2.5 text-sm text-medium-gray rounded-lg"
                                >
                                    <span class="dropdown-link-text">Gallery</span>
                                </a>
                                <a
                                    href={`${base}corporate-collaborations`}
                                    class="dropdown-link block px-4 py-2.5 text-sm text-medium-gray rounded-lg"
                                >
                                    <span class="dropdown-link-text">Corporate Collabs</span>
                                </a>
                                <a
                                    href={`${base}community-collaborations`}
                                    class="dropdown-link block px-4 py-2.5 text-sm text-medium-gray rounded-lg"
                                >
                                    <span class="dropdown-link-text">Community Collabs</span>
                                </a>

                                <a
                                    href={`${base}faq`}
                                    class="dropdown-link block px-4 py-2.5 text-sm text-medium-gray rounded-lg"
                                >
                                    <span class="dropdown-link-text">FAQ</span>
                                </a>
                                <a
                                    href={`${base}contact`}
                                    class="dropdown-link block px-4 py-2.5 text-sm text-medium-gray rounded-lg"
                                >
                                    <span class="dropdown-link-text">Contact</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </nav>

                {/* CTAs */}
                <div
                    class="flex items-center gap-4 pl-4 border-l border-gray-200"
                >
                    <a
                        href={`${base}account`}
                        class="link-underline text-sm font-bold text-medium-gray"
                    >
                        My Account
                    </a>
                    <a
                        href="https://www.zeffy.com/en-US/donation-form/support-the-latina-sweat-project"
                        target="_blank"
                        rel="noopener noreferrer"
                        class="btn hidden sm:inline-flex items-center h-10 rounded-full bg-vibrant-pink px-6 text-sm font-bold text-white shadow-md transition-all hover:scale-105 hover:shadow-lg"
                    >
                        Donate
                    </a>
                    <a
                        href={`${base}schedule`}
                        class="btn hidden sm:inline-flex items-center h-10 rounded-full bg-off-black px-6 text-sm font-bold text-white shadow-md transition-all hover:scale-105 hover:shadow-lg hover:bg-vibrant-pink"
                    >
                        Book Class
                    </a>
                </div>
            </div>

            {/* Mobile Menu Button */}
            <div class="xl:hidden flex items-center gap-4">
                <a
                    href={`${base}schedule`}
                    class="btn inline-flex items-center h-9 rounded-full bg-vibrant-pink px-4 text-xs font-bold text-white shadow-sm sm:hidden"
                >
                    Book
                </a>
                <button
                    id="mobile-menu-toggle"
                    class="relative z-50 p-2 text-off-black focus:outline-none group"
                    aria-label="Toggle Menu"
                >
                    <div class="w-6 h-5 flex flex-col justify-between relative">
                        <span
                            class="w-full h-0.5 bg-current transition-all duration-300 transform"
                            id="hamburger-top"></span>
                        <span
                            class="w-full h-0.5 bg-current transition-all duration-300 transform"
                            id="hamburger-middle"></span>
                        <span
                            class="w-full h-0.5 bg-current transition-all duration-300 transform"
                            id="hamburger-bottom"></span>
                    </div>
                </button>
            </div>
        </div>
    </header>
</div>

{/* Spacer for fixed header to prevent overlap */}
<div id="header-spacer" class="h-20"></div>

{/* Mobile Menu Overlay */}
<div
    id="mobile-menu-overlay"
    class="fixed inset-0 z-40 bg-white/95 backdrop-blur-xl transform translate-x-full transition-transform duration-300 flex flex-col pt-24 px-6 pb-8 overflow-y-auto h-screen"
>
    <nav class="flex flex-col gap-4 text-center">
        <a
            href={base}
            class="text-xl font-bold text-off-black hover:text-vibrant-pink transition-colors mobile-link py-1"
        >
            Home
        </a>
        <a
            href={`${base}about`}
            class="text-xl font-bold text-off-black hover:text-vibrant-pink transition-colors mobile-link py-1"
        >
            About Us
        </a>
        <a
            href={`${base}schedule`}
            class="text-xl font-bold text-off-black hover:text-vibrant-pink transition-colors mobile-link py-1"
        >
            Classes
        </a>
        <a
            href={`${base}events`}
            class="text-xl font-bold text-off-black hover:text-vibrant-pink transition-colors mobile-link py-1"
        >
            Events
        </a>
        <a
            href={`${base}pricing`}
            class="text-xl font-bold text-off-black hover:text-vibrant-pink transition-colors mobile-link py-1"
        >
            Pricing
        </a>
        <a
            href={`${base}impact`}
            class="text-xl font-bold text-off-black hover:text-vibrant-pink transition-colors mobile-link py-1"
        >
            Impact
        </a>
        <a
            href={`${base}shifts`}
            class="text-xl font-bold text-off-black hover:text-vibrant-pink transition-colors mobile-link py-1"
        >
            Volunteer
        </a>
        <a
            href={`${base}gallery`}
            class="text-xl font-bold text-off-black hover:text-vibrant-pink transition-colors mobile-link py-1"
        >
            Gallery
        </a>
        <a
            href={`${base}gala`}
            class="text-xl font-bold text-off-black hover:text-vibrant-pink transition-colors mobile-link py-1"
        >
            Gala
        </a>
        <a
            href={`${base}corporate-collaborations`}
            class="text-xl font-bold text-off-black hover:text-vibrant-pink transition-colors mobile-link py-1"
        >
            Corporate Collabs
        </a>
        <a
            href={`${base}community-collaborations`}
            class="text-xl font-bold text-off-black hover:text-vibrant-pink transition-colors mobile-link py-1"
        >
            Community Collabs
        </a>

        <a
            href={`${base}faq`}
            class="text-xl font-bold text-off-black hover:text-vibrant-pink transition-colors mobile-link py-1"
        >
            FAQ
        </a>
        <a
            href={`${base}contact`}
            class="text-xl font-bold text-off-black hover:text-vibrant-pink transition-colors mobile-link py-1"
        >
            Contact
        </a>
        <hr class="border-gray-200 my-2" />
        <a
            href={`${base}account`}
            class="text-lg font-medium text-medium-gray hover:text-vibrant-pink mobile-link py-1"
            >My Account</a
        >
        <!-- iPhone App Available Banner -->
        <a
            href="https://apps.apple.com/us/app/lsp-studio/id6755971141"
            target="_blank"
            rel="noopener noreferrer"
            class="group mt-2 flex items-center justify-center gap-3 rounded-xl border border-accent-gold/40 bg-off-black px-4 py-3 mobile-link"
        >
            <span
                class="flex h-10 w-10 items-center justify-center rounded-lg bg-white p-1"
            >
                <img
                    src={`${base}images/lsp-studio-logo.png`}
                    alt="LSP Studio App"
                    class="h-full w-full object-contain"
                />
            </span>
            <div class="flex flex-col text-left">
                <span
                    class="text-xs font-semibold uppercase tracking-wider text-accent-gold"
                    >Now on iPhone</span
                >
                <span class="text-base font-bold text-white"
                    >LSP Studio App</span
                >
            </div>
            <div class="flex items-center gap-1 text-accent-gold">
                <svg
                    class="h-4 w-4"
                    fill="currentColor"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                >
                    <path
                        d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"
                    ></path>
                </svg>
                <svg
                    class="h-4 w-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9 5l7 7-7 7"></path>
                </svg>
            </div>
        </a>
        <div class="flex flex-col gap-3 mt-4 pb-8">
            <a
                href="https://www.zeffy.com/en-US/donation-form/support-the-latina-sweat-project"
                target="_blank"
                rel="noopener noreferrer"
                class="btn w-full py-3 rounded-full bg-vibrant-pink text-white font-bold shadow-lg text-lg"
            >
                Donate
            </a>
            <a
                href={`${base}schedule`}
                class="btn w-full py-3 rounded-full bg-off-black text-white font-bold shadow-lg text-lg"
            >
                Book a Class
            </a>
        </div>
    </nav>
</div>

<script>
    const header = document.getElementById("main-header");
    const toggleBtn = document.getElementById("mobile-menu-toggle");
    const overlay = document.getElementById("mobile-menu-overlay");
    const topBar = document.getElementById("hamburger-top");
    const middleBar = document.getElementById("hamburger-middle");
    const bottomBar = document.getElementById("hamburger-bottom");
    let isMenuOpen = false;

    // Scroll Effect
    const updateHeader = () => {
        // If menu is open, force solid white background
        if (isMenuOpen) {
            header?.classList.add("bg-white");
            header?.classList.remove(
                "bg-white/80",
                "bg-white/95",
                "backdrop-blur-md",
                "border-transparent",
            );
            header?.classList.add("border-gray-100"); // Optional: keep border
            return;
        }

        if (window.scrollY > 10) {
            header?.classList.add(
                "shadow-sm",
                "bg-white/95",
                "backdrop-blur-md",
            );
            header?.classList.remove(
                "bg-white",
                "bg-white/80",
                "border-transparent",
            );
            header?.classList.add("border-gray-100");
        } else {
            header?.classList.remove(
                "shadow-sm",
                "bg-white",
                "bg-white/95",
                "border-gray-100",
            );
            header?.classList.add(
                "bg-white/80",
                "backdrop-blur-md",
                "border-transparent",
            );
        }
    };
    window.addEventListener("scroll", updateHeader);
    updateHeader(); // Init

    // Mobile Menu Toggle
    toggleBtn?.addEventListener("click", () => {
        isMenuOpen = !isMenuOpen;
        toggleBtn.setAttribute("aria-expanded", isMenuOpen.toString());

        if (isMenuOpen) {
            overlay?.classList.remove("translate-x-full");
            document.body.style.overflow = "hidden";

            // Animate Hamburger to X
            topBar?.classList.add("rotate-45", "translate-y-[9px]");
            middleBar?.classList.add("opacity-0");
            bottomBar?.classList.add("-rotate-45", "-translate-y-[9px]");
        } else {
            overlay?.classList.add("translate-x-full");
            document.body.style.overflow = "";

            // Reset Hamburger
            topBar?.classList.remove("rotate-45", "translate-y-[9px]");
            middleBar?.classList.remove("opacity-0");
            bottomBar?.classList.remove("-rotate-45", "-translate-y-[9px]");
        }
        updateHeader(); // Update header style based on new menu state
    });

    // Close menu when clicking a link
    const mobileLinks = document.querySelectorAll(".mobile-link");
    mobileLinks.forEach((link) => {
        link.addEventListener("click", () => {
            if (isMenuOpen) toggleBtn?.click();
        });
    });

    // More Dropdown Logic (Click + Hover)
    const moreBtn = document.getElementById("more-dropdown-button");
    const moreMenu = document.getElementById("more-dropdown-menu");
    const moreContainer = document.getElementById("more-dropdown-container");
    let isDropdownOpen = false;

    // Function to show/hide
    const setDropdownState = (isOpen) => {
        isDropdownOpen = isOpen;
        moreBtn?.setAttribute("aria-expanded", isOpen.toString());
        if (isOpen) {
            moreMenu?.classList.remove("opacity-0", "invisible");
        } else {
            moreMenu?.classList.add("opacity-0", "invisible");
        }
    };

    // Toggle on click
    moreBtn?.addEventListener("click", (e) => {
        e.stopPropagation();
        setDropdownState(!isDropdownOpen);
    });

    // Hover handling via JS to ensure reliability
    moreContainer?.addEventListener("mouseenter", () => {
        setDropdownState(true);
    });

    moreContainer?.addEventListener("mouseleave", () => {
        setDropdownState(false);
    });

    // Close on click outside
    document.addEventListener("click", (e) => {
        if (isDropdownOpen && moreContainer && !moreContainer.contains(e.target as Node)) {
            setDropdownState(false);
        }
    });
</script>
